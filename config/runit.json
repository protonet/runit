{

  "defaults": {
    "options": {
      "setuidgid": "protonet:protonet"
    },
    "env": {
      "rails_env": "production",
      "rack_env":  "production"
    }
  },

  "services": {
    "rabbitmq": {
      "commands": {
        "start": "/usr/lib/rabbitmq/bin/rabbitmq-server"
      },
      "options": {
        "setuidgid": "rabbitmq:rabbitmq",
        "root":      "/var/lib/rabbitmq"
      },
      "env": {
        "rabbitmq_nodename": "protonet",
        "home":              "/var/lib/rabbitmq"
      }
    },
    "apache2": {
      "depends": ["rabbitmq"],
      "commands": {
        "start": "apachectl -f /etc/apache2/apache2.conf -D FOREGROUND"
      }
    },
    "node.js": {
      "depends": ["rabbitmq"],
      "env": {
        "node_port": 8124
      },
      "options": {
        "root": "/home/protonet/dashboard/current"
      },
      "commands": {
        "start": "node ./node/node.js port=8124 env=production"
      }
    },
    "js_dispatcher": {
      "depends": ["rabbitmq"],
      "commands": {
        "start": "bundle exec ruby ./messaging/event_machine/js_dispatching_server.rb"
      },
      "sources": [ "/usr/local/rvm/scipts/rvm" ],
      "options": {
        "root": "/home/protonet/dashboard/current"
      }
    },
    "solr": {
      "depends": ["rabbitmq"],
      "sources": [ "/usr/local/rvm/scipts/rvm" ],
      "options": {
        "root": "/home/protonet/dashboard/current"
      },
      "commands": {
        "start": "bundle exec rake sunspot:solr:run"
      }
    },
    "app_monit": {
      "depends": ["rabbitmq", "apache2", "node.js", "js_dispatcher", "solr"],
      "options": {
        "root": "/home/protonet/shared/"
      },
      "commands": {
        "start": "monit -c ./config/monit_ptn_node"
      }
    }
  }

}
